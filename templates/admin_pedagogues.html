<!DOCTYPE html>
<html>
<head>
    <title>Gestion des Responsables P√©dagogiques - Administrateur</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            overflow-x: hidden;
        }

        .data-container {
            width: 100%;
            padding: 20px;
            margin: 0 auto;
            overflow-x: auto;
        }

        .data-grid {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            background: white;
        }

        .data-grid th {
            background: #8052e6;
            color: white;
            padding: 15px;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 2;
        }

        .data-grid td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            min-width: 120px;
            position: relative;
        }

        .data-grid input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .action-bar {
            margin-bottom: 20px;
            display: flex;
            justify-content: flex-start;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-download {
            background: #007bff;
            color: white;
        }

        .btn-add {
            background: #ffc107;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .password-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toggle-password {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
        }

        input[type="date"] {
            appearance: none;
            -webkit-appearance: none;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>') center/100% no-repeat;
            color: #8052e6;
        }

        input::placeholder {
            color: #999;
            font-style: italic;
        }

        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .search-container input {
            width: 300px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .search-container button {
            padding: 12px 20px;
            background-color: #8052e6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .search-container button:hover {
            background-color: #6a40d0;
        }
    </style>
</head>
<body>
    <div class="data-container">
        <div class="search-container">
            <input type="text" id="search-input" placeholder="Rechercher un responsable p√©dagogique...">
            <button id="search-button">Rechercher</button>
        </div>

        <div class="action-bar">
            <button class="btn btn-download" id="download-btn">üì• T√©l√©charger Excel</button>
            <button class="btn btn-save" id="save-btn">üíæ Sauvegarder</button>
            <button class="btn btn-add" id="add-btn">‚ûï Ajouter</button>
        </div>

        <table class="data-grid" id="pedagoguesTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Pr√©nom</th>
                    <th>Email</th>
                    <th>Mot de passe</th>
                    <th>T√©l√©phone</th>
                    <th>Ville</th>
                    <th>Code Coupon</th>
                    <th>Centre</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for pedagogue in pedagogues %}
                <tr data-id="{{ pedagogue.id }}">
                    <td>{{ loop.index }}</td>
                    <td><input data-field="Nom" value="{{ pedagogue.Nom or '' }}"></td>
                    <td><input data-field="Prenom" value="{{ pedagogue.Prenom or '' }}"></td>
                    <td><input type="email" data-field="AdresseEmail" value="{{ pedagogue.AdresseEmail or '' }}"></td>
                    <td>
                        <div class="password-container">
                            <input type="password" data-field="MotDePasse" value="{{ pedagogue.MotDePasse or '' }}">
                            <button class="toggle-password" onclick="togglePassword(this)">üëÅÔ∏è</button>
                        </div>
                    </td>
                    <td><input type="tel" data-field="Phone" value="{{ pedagogue.Phone or '' }}"></td>
                    <td><input data-field="Ville" value="{{ pedagogue.Ville or '' }}"></td>
                    <td><input data-field="CodeCoupon" value="{{ pedagogue.CodeCoupon or '' }}"></td>
                    <td><input data-field="Centre" value="{{ pedagogue.Centre or '' }}"></td>
                    <td>
                        <button class="btn btn-delete" onclick="deleteRow(this)">Supprimer</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script>
        function togglePassword(button) {
            const input = button.parentElement.querySelector('input');
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const searchInput = document.getElementById("search-input");
            const tableRows = document.querySelectorAll("#pedagoguesTable tbody tr");

            searchInput.addEventListener("input", function () {
                const query = searchInput.value.toLowerCase().trim();

                tableRows.forEach(row => {
                    const cells = row.querySelectorAll("td input");
                    let match = false;

                    cells.forEach(cell => {
                        if (cell.value.toLowerCase().includes(query)) {
                            match = true;
                        }
                    });

                    row.style.display = match ? "" : "none";
                });
            });
        });
    </script>
    <script>
        document.getElementById('download-btn').addEventListener('click', function () {
            window.location.href = '/download-pedagogues-excel';
        });
    </script>
    <script>
        let currentId = {{ pedagogues|length }} + 1;

        document.getElementById('add-btn').addEventListener('click', () => {
            const table = document.getElementById('pedagoguesTable').getElementsByTagName('tbody')[0];

            const newRow = document.createElement('tr');
            newRow.setAttribute('data-id', 'new');

            newRow.innerHTML = `
                <td>${currentId}</td>
                <td><input data-field="Nom" placeholder="Nom"></td>
                <td><input data-field="Prenom" placeholder="Pr√©nom"></td>
                <td><input type="email" data-field="AdresseEmail" placeholder="Email"></td>
                <td>
                    <div class="password-container">
                        <input type="password" data-field="MotDePasse" placeholder="Mot de passe">
                        <button class="toggle-password" onclick="togglePassword(this)">üëÅÔ∏è</button>
                    </div>
                </td>
                <td><input type="tel" data-field="Phone" placeholder="T√©l√©phone"></td>
                <td><input data-field="Ville" placeholder="Ville"></td>
                <td><input data-field="CodeCoupon" placeholder="Code Coupon"></td>
                <td><input data-field="Centre" placeholder="Centre"></td>
                <td>
                    <button class="btn btn-delete" onclick="deleteRow(this)">Supprimer</button>
                </td>
            `;

            table.appendChild(newRow);
            currentId++;

            newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    </script>
    <script>
        document.getElementById('save-btn').addEventListener('click', () => {
            const rows = document.querySelectorAll('#pedagoguesTable tbody tr');
            const changes = [];

            rows.forEach(row => {
                const id = row.getAttribute('data-id');
                const inputs = row.querySelectorAll('input');
                const data = {};

                inputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    const value = input.value;
                    data[field] = value;
                });

                if (id === 'new') {
                    changes.push({
                        action: 'create',
                        ...data
                    });
                }
                else if (!isNaN(id)) {
                    changes.push({
                        action: 'update',
                        id: parseInt(id),
                        fields: data
                    });
                }
            });

            fetch('/save-pedagogues', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(changes)
            })
            .then(res => res.json())
            .then(response => {
                if (response.status === 'success') {
                    alert("Sauvegarde r√©ussie !");
                    location.reload();
                } else {
                    alert("Erreur : " + response.message);
                }
            })
            .catch(err => {
                alert("Erreur r√©seau : " + err.message);
            });
        });
    </script>
    <script>
function deleteRow(button) {
    const row = button.closest("tr");
    const pedagogueId = row.getAttribute("data-id");

    if (!pedagogueId || pedagogueId === "new") {
        row.remove();
        return;
    }

    if (!confirm("Voulez-vous vraiment supprimer ce responsable ?")) return;

    fetch(`/delete-pedagogue/${pedagogueId}`, {
        method: "DELETE"
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            row.remove();
        } else {
            alert("Erreur lors de la suppression : " + data.message);
        }
    })
    .catch(error => {
        alert("Erreur r√©seau : " + error);
    });
}
</script>
</body>
</html>